# Phase 3: Enhanced Drone Control Features

## æ¦‚è¦

Phase 3 Enhanced ã§ã¯ã€æ—¢å­˜ã®Phase 3åŸºç›¤ã‚’æ‹¡å¼µã—ã€ãƒ‰ãƒ­ãƒ¼ãƒ³åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ã«é«˜åº¦ãªæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚ç²¾å¯†ãªé£›è¡Œåˆ¶å¾¡ã€å®‰å…¨æ€§ã®å‘ä¸Šã€ãƒ“ã‚¸ãƒ§ãƒ³å‡¦ç†ã®å¼·åŒ–ã€å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åé›†ã®è‡ªå‹•åŒ–ã‚’å®Ÿç¾ã—ã€ç”£æ¥­ç”¨é€”ã«é©ç”¨å¯èƒ½ãªé«˜ç²¾åº¦ãƒ»é«˜å®‰å…¨æ€§ã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚

## ğŸš€ æ–°æ©Ÿèƒ½ä¸€è¦§

### 1. Enhanced Drone Manager
- **ç²¾å¯†é£›è¡Œåˆ¶å¾¡**: 5cmç²¾åº¦ã®é«˜åº¦åˆ¶å¾¡
- **é«˜åº¦å®‰å…¨ã‚·ã‚¹ãƒ†ãƒ **: å¤šå±¤é˜²å¾¡ã¨å¢ƒç•Œãƒã‚§ãƒƒã‚¯
- **é£›è¡Œè¨ˆç”»å®Ÿè¡Œ**: ã‚¦ã‚§ã‚¤ãƒã‚¤ãƒ³ãƒˆãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–**: ç¶™ç¶šçš„ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç›£è¦–
- **å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åé›†**: å¤šè§’åº¦ãƒ»å¤šé«˜åº¦æ’®å½±ã®è‡ªå‹•åŒ–

### 2. Enhanced Vision Service
- **é«˜åº¦ç‰©ä½“æ¤œå‡º**: YOLOv8ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ6ç¨®é¡ã®ãƒ¢ãƒ‡ãƒ«ï¼‰
- **OpenCVè¿½è·¡**: è¤‡æ•°ã®è¿½è·¡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å¯¾å¿œ
- **å­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³**: ãƒ‡ãƒ¼ã‚¿å“è³ªç®¡ç†ã¨çµ±è¨ˆ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ çµ±è¨ˆ

### 3. Enhanced API Endpoints
- **25+ æ–°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: å¼·åŒ–ã•ã‚ŒãŸãƒ‰ãƒ­ãƒ¼ãƒ³åˆ¶å¾¡API
- **åˆ†æãƒ»ç›£è¦–API**: è©³ç´°ãªãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨çµ±è¨ˆ
- **ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†**: è¨­å®šæ›´æ–°ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

## ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
MCPã‚µãƒ¼ãƒãƒ¼ (Phase 1/2)
    â†“ è‡ªç„¶è¨€èªå‡¦ç†
Enhanced Drone Manager â†â†’ Enhanced Vision Service
    â†“ ç²¾å¯†åˆ¶å¾¡              â†“ é«˜åº¦å‡¦ç†
ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼    â† OpenCVè¿½è·¡ãƒ»å­¦ç¿’ãƒ‡ãƒ¼ã‚¿
    â†“
Tello EDU ãƒ‰ãƒ­ãƒ¼ãƒ³
```

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹æˆ

```
backend/api_server/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ enhanced_drone_manager.py    # ğŸ†• å¼·åŒ–ã•ã‚ŒãŸãƒ‰ãƒ­ãƒ¼ãƒ³ç®¡ç†
â”‚   â”œâ”€â”€ enhanced_vision_service.py   # ğŸ†• å¼·åŒ–ã•ã‚ŒãŸãƒ“ã‚¸ãƒ§ãƒ³å‡¦ç†
â”‚   â””â”€â”€ ...
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ enhanced_drones.py          # ğŸ†• å¼·åŒ–ã•ã‚ŒãŸãƒ‰ãƒ­ãƒ¼ãƒ³API
â”‚   â””â”€â”€ ...
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_phase3_enhanced_features.py  # ğŸ†• å¼·åŒ–æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ ...
â””â”€â”€ PHASE3_ENHANCED_README.md       # ğŸ†• ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

## ğŸ¯ é£›è¡Œãƒ¢ãƒ¼ãƒ‰

Phase 3 Enhanced ã§ã¯6ã¤ã®é£›è¡Œãƒ¢ãƒ¼ãƒ‰ã‚’æä¾›ï¼š

1. **Manual**: æ‰‹å‹•åˆ¶å¾¡ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
2. **Auto**: è‡ªå‹•é£›è¡Œè¨ˆç”»å®Ÿè¡Œ
3. **Guided**: ã‚¬ã‚¤ãƒ‰ä»˜ãåˆ¶å¾¡
4. **Tracking**: ç‰©ä½“è¿½è·¡ãƒ¢ãƒ¼ãƒ‰
5. **Learning Data Collection**: å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åé›†ãƒ¢ãƒ¼ãƒ‰
6. **Emergency**: ç·Šæ€¥ãƒ¢ãƒ¼ãƒ‰

## ğŸ›¡ï¸ å®‰å…¨ã‚·ã‚¹ãƒ†ãƒ 

### å®‰å…¨å¢ƒç•Œ
```python
FlightBounds:
  min_x: -10.0m, max_x: 10.0m
  min_y: -10.0m, max_y: 10.0m  
  min_z: 0.2m,   max_z: 5.0m
```

### å®‰å…¨ãƒã‚§ãƒƒã‚¯é …ç›®
- ãƒãƒƒãƒ†ãƒªãƒ¼ãƒ¬ãƒ™ãƒ«ç›£è¦–ï¼ˆæœ€å°15%ã€ç·Šæ€¥10%ï¼‰
- é£›è¡Œå¢ƒç•Œãƒã‚§ãƒƒã‚¯
- æœ€å¤§é£›è¡Œæ™‚é–“ï¼ˆ1200ç§’ï¼‰
- è¡çªå›é¿
- é¢¨é€Ÿåˆ¶é™ï¼ˆ5.0m/sï¼‰

### å®‰å…¨é•åã®è‡ªå‹•è¨˜éŒ²
```python
SafetyViolation:
  type: str                # é•åã‚¿ã‚¤ãƒ—
  timestamp: datetime      # ç™ºç”Ÿæ™‚åˆ»
  details: Dict[str, Any]  # è©³ç´°æƒ…å ±
  severity: SafetyLevel    # é‡è¦åº¦
```

## ğŸ”§ APIä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªåˆ¶å¾¡

#### 1. å¼·åŒ–ã•ã‚ŒãŸæ¥ç¶š
```bash
curl -X POST "http://localhost:8000/api/drones/drone_001/connect/enhanced" \
  -H "X-API-Key: your-api-key"
```

#### 2. é£›è¡Œãƒ¢ãƒ¼ãƒ‰è¨­å®š
```bash
curl -X POST "http://localhost:8000/api/drones/drone_001/flight_mode" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '"auto"'
```

#### 3. ç²¾å¯†é«˜åº¦åˆ¶å¾¡
```bash
curl -X POST "http://localhost:8000/api/drones/drone_001/altitude/precise" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "target_height": 150,
    "mode": "absolute", 
    "speed": 0.5,
    "timeout": 30.0
  }'
```

### é£›è¡Œè¨ˆç”»å®Ÿè¡Œ

```bash
curl -X POST "http://localhost:8000/api/drones/drone_001/flight_plan" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "waypoints": [
      [1.0, 1.0, 1.0],
      [2.0, 2.0, 1.5],
      [0.0, 2.0, 1.0]
    ],
    "speed": 1.0,
    "altitude_mode": "absolute",
    "safety_checks": true
  }'
```

### å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åé›†

```bash
curl -X POST "http://localhost:8000/api/drones/drone_001/learning_data/collect/enhanced" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "object_name": "person",
    "capture_positions": ["front", "back", "left", "right"],
    "movement_distance": 50,
    "photos_per_position": 3,
    "altitude_levels": [100, 150, 200],
    "rotation_angles": [0, 45, 90, 135, 180, 225, 270, 315],
    "quality": "high"
  }'
```

### é«˜åº¦ç‰©ä½“æ¤œå‡º

```bash
curl -X POST "http://localhost:8000/api/vision/detection/enhanced" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "image_data": "<base64_encoded_image>",
    "model_id": "yolo_v8_person_detector",
    "confidence_threshold": 0.7,
    "filter_labels": ["person"],
    "max_detections": 5
  }'
```

### å¼·åŒ–ã•ã‚ŒãŸè¿½è·¡

```bash
curl -X POST "http://localhost:8000/api/vision/tracking/start/enhanced" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "model_id": "yolo_v8_general",
    "drone_id": "drone_001",
    "config": {
      "algorithm": "csrt",
      "confidence_threshold": 0.5,
      "follow_distance": 200,
      "max_tracking_loss": 30,
      "update_interval": 0.1
    }
  }'
```

## ğŸ“Š ç›£è¦–ãƒ»åˆ†æAPI

### ãƒ‰ãƒ­ãƒ¼ãƒ³ãƒ¡ãƒˆãƒªã‚¯ã‚¹
```bash
curl -X GET "http://localhost:8000/api/drones/drone_001/metrics" \
  -H "X-API-Key: your-api-key"
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ï¼š
```json
{
  "total_flight_time": 1234.5,
  "total_distance": 567.8,
  "total_photos": 89,
  "emergency_stops": 0,
  "safety_violations": 2,
  "performance_score": 95.3,
  "last_maintenance": null
}
```

### å®‰å…¨é•åå±¥æ­´
```bash
curl -X GET "http://localhost:8000/api/drones/drone_001/safety/violations" \
  -H "X-API-Key: your-api-key"
```

### é£›è¡Œãƒ­ã‚°
```bash
curl -X GET "http://localhost:8000/api/drones/drone_001/logs/flight?limit=100" \
  -H "X-API-Key: your-api-key"
```

### ç·åˆåˆ†æ
```bash
curl -X GET "http://localhost:8000/api/system/analytics/overall" \
  -H "X-API-Key: your-api-key"
```

## ğŸ” ãƒ“ã‚¸ãƒ§ãƒ³ãƒ¢ãƒ‡ãƒ«

### åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«

1. **yolo_v8_general**: æ±ç”¨ç‰©ä½“æ¤œå‡ºï¼ˆ80ã‚¯ãƒ©ã‚¹ï¼‰
2. **yolo_v8_person_detector**: äººç‰©æ¤œå‡ºå°‚ç”¨
3. **yolo_v8_vehicle_detector**: è»Šä¸¡æ¤œå‡ºå°‚ç”¨
4. **ssd_mobilenet_v2**: è»½é‡ç‰©ä½“æ¤œå‡º
5. **faster_rcnn_resnet50**: é«˜ç²¾åº¦ç‰©ä½“æ¤œå‡º
6. **custom_people_tracker**: ã‚«ã‚¹ã‚¿ãƒ äººç‰©è¿½è·¡

### è¿½è·¡ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

- **CSRT**: é«˜ç²¾åº¦è¿½è·¡ï¼ˆæ¨å¥¨ï¼‰
- **KCF**: é«˜é€Ÿè¿½è·¡
- **MOSSE**: è¶…é«˜é€Ÿè¿½è·¡
- **MEDIANFLOW**: äºˆæ¸¬å‹è¿½è·¡
- **TLD**: é•·æœŸè¿½è·¡
- **BOOSTING**: åŸºæœ¬è¿½è·¡

### ãƒ¢ãƒ‡ãƒ«ä¸€è¦§å–å¾—
```bash
curl -X GET "http://localhost:8000/api/vision/models/enhanced" \
  -H "X-API-Key: your-api-key"
```

## ğŸ§ª å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åé›†

### è‡ªå‹•åŒ–ã•ã‚ŒãŸæ’®å½±ãƒ‘ã‚¿ãƒ¼ãƒ³

Phase 3 Enhanced ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åé›†ã§ã¯ä»¥ä¸‹ã®è‡ªå‹•åŒ–ã‚’æä¾›ï¼š

1. **å¤šè§’åº¦æ’®å½±**: å‰å¾Œå·¦å³ã®è¤‡æ•°è§’åº¦
2. **å¤šé«˜åº¦æ’®å½±**: è¤‡æ•°ã®é«˜åº¦ãƒ¬ãƒ™ãƒ«
3. **å›è»¢æ’®å½±**: æŒ‡å®šè§’åº¦ã§ã®å›è»¢æ’®å½±
4. **å“è³ªè©•ä¾¡**: è‡ªå‹•çš„ãªç”»åƒå“è³ªã‚¹ã‚³ã‚¢ç®—å‡º
5. **ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿**: æ’®å½±æ¡ä»¶ã®è©³ç´°è¨˜éŒ²

### å­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹
```bash
curl -X POST "http://localhost:8000/api/learning_data/session/start" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "object_name": "industrial_robot",
    "session_config": {
      "quality_threshold": 0.8,
      "auto_annotation": true
    }
  }'
```

#### ã‚µãƒ³ãƒ—ãƒ«è¿½åŠ 
```bash
curl -X POST "http://localhost:8000/api/learning_data/session/{session_id}/add_sample" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "image_data": "<base64_image>",
    "annotation": {
      "label": "industrial_robot",
      "bbox": [100, 100, 200, 200],
      "metadata": {
        "position": "front",
        "altitude": 150,
        "angle": 45
      }
    },
    "quality_score": 0.85
  }'
```

#### ã‚»ãƒƒã‚·ãƒ§ãƒ³å®Œäº†
```bash
curl -X POST "http://localhost:8000/api/learning_data/session/{session_id}/finish" \
  -H "X-API-Key: your-api-key"
```

## âš™ï¸ è¨­å®šã¨ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### å®‰å…¨è¨­å®šã®æ›´æ–°

```bash
curl -X PUT "http://localhost:8000/api/system/safety/config" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{
    "min_battery_level": 20,
    "max_flight_time": 1800,
    "emergency_landing_battery": 15,
    "collision_avoidance": true,
    "wind_speed_limit": 8.0,
    "max_velocity": 3.0,
    "flight_bounds": {
      "min_x": -15.0,
      "max_x": 15.0,
      "min_y": -15.0,
      "max_y": 15.0,
      "min_z": 0.5,
      "max_z": 8.0
    }
  }'
```

### ç¾åœ¨ã®å®‰å…¨è¨­å®šç¢ºèª
```bash
curl -X GET "http://localhost:8000/api/system/safety/config" \
  -H "X-API-Key: your-api-key"
```

## ğŸš¦ ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†

### å¼·åŒ–ã•ã‚ŒãŸãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
```bash
curl -X GET "http://localhost:8000/api/system/health/enhanced" \
  -H "X-API-Key: your-api-key"
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ï¼š
```json
{
  "timestamp": "2023-01-01T12:00:00Z",
  "overall_status": "healthy",
  "components": {
    "enhanced_drone_manager": {
      "status": "running",
      "monitoring_active": true,
      "connected_drones": 2,
      "active_tasks": 1
    },
    "enhanced_vision_service": {
      "status": "running",
      "tracking_active": true,
      "active_trackers": 1,
      "available_models": 6
    }
  },
  "performance_metrics": {
    "total_flight_time": 3600.0,
    "average_performance_score": 94.2,
    "recent_safety_violations": 0
  }
}
```

### ã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
```bash
curl -X POST "http://localhost:8000/api/system/cleanup" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: your-api-key" \
  -d '{"max_age_hours": 24}'
```

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

### ãƒ‰ãƒ­ãƒ¼ãƒ³æ€§èƒ½ã‚¹ã‚³ã‚¢è¨ˆç®—
ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚¹ã‚³ã‚¢ï¼ˆ0-100ï¼‰ã¯ä»¥ä¸‹ã®è¦ç´ ã§è¨ˆç®—ï¼š
- **åŸºæœ¬ã‚¹ã‚³ã‚¢**: 100ç‚¹
- **ãƒãƒƒãƒ†ãƒªãƒ¼åŠ¹ç‡**: æ™‚é–“ã‚ãŸã‚Šã®ãƒãƒƒãƒ†ãƒªãƒ¼æ¶ˆè²»åŠ¹ç‡
- **å®‰å…¨é•å**: -5ç‚¹/ä»¶
- **ç·Šæ€¥åœæ­¢**: -15ç‚¹/ä»¶

### ãƒ“ã‚¸ãƒ§ãƒ³å‡¦ç†çµ±è¨ˆ
- **å¹³å‡æ¤œå‡ºæ•°**: ãƒ•ãƒ¬ãƒ¼ãƒ ã‚ãŸã‚Šã®å¹³å‡æ¤œå‡ºæ•°
- **å¹³å‡ä¿¡é ¼åº¦**: æ¤œå‡ºã®å¹³å‡ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢
- **ç·æ¨è«–å›æ•°**: å®Ÿè¡Œã•ã‚ŒãŸæ¨è«–ã®ç·æ•°
- **è¿½è·¡æˆåŠŸç‡**: è¿½è·¡æˆåŠŸãƒ•ãƒ¬ãƒ¼ãƒ æ•° / ç·ãƒ•ãƒ¬ãƒ¼ãƒ æ•°

### ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆå–å¾—
```bash
curl -X GET "http://localhost:8000/api/system/analytics/vision" \
  -H "X-API-Key: your-api-key"
```

## ğŸ”§ é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
```bash
# Phase 3 Enhanced ã®å…¨ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
cd backend
python -m pytest tests/test_phase3_enhanced_features.py -v

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã®ã¿å®Ÿè¡Œ
python -m pytest tests/test_phase3_enhanced_features.py::TestEnhancedDroneManager -v
python -m pytest tests/test_phase3_enhanced_features.py::TestEnhancedVisionService -v
python -m pytest tests/test_phase3_enhanced_features.py::TestIntegration -v

# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
python -m pytest tests/test_phase3_enhanced_features.py::TestPerformance -v

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
pytest tests/test_phase3_enhanced_features.py --cov=api_server.core --cov-report=html
```

### é–‹ç™ºç”¨ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
```bash
cd backend
python start_api_server.py
```

### å¼·åŒ–æ©Ÿèƒ½ä»˜ãMCPã‚µãƒ¼ãƒãƒ¼èµ·å‹•
```bash
cd mcp-server
python start_mcp_server.py --enhanced
```

## ğŸŒŸ ä½¿ç”¨ä¾‹ãƒ»ã‚·ãƒŠãƒªã‚ª

### ã‚·ãƒŠãƒªã‚ª1: ç”£æ¥­æ–½è¨­ç‚¹æ¤œ
```python
# 1. ãƒ‰ãƒ­ãƒ¼ãƒ³æ¥ç¶šãƒ»é›¢é™¸
await connect_drone("drone_001")
await set_flight_mode("drone_001", "auto")
await takeoff_drone("drone_001")

# 2. æ–½è¨­å‘¨å›²ã®è©³ç´°é£›è¡Œè¨ˆç”»å®Ÿè¡Œ
flight_plan = {
    "waypoints": [
        [0, 0, 2],      # é–‹å§‹ç‚¹
        [10, 0, 2],     # æ–½è¨­æ±å´
        [10, 10, 3],    # æ–½è¨­åŒ—æ±è§’ï¼ˆé«˜åº¦ä¸Šã’ï¼‰
        [0, 10, 3],     # æ–½è¨­åŒ—å´
        [-10, 10, 2],   # æ–½è¨­åŒ—è¥¿è§’
        [-10, 0, 2],    # æ–½è¨­è¥¿å´
        [0, 0, 2]       # å¸°é‚„
    ],
    "speed": 0.8,
    "altitude_mode": "absolute",
    "safety_checks": True,
    "completion_timeout": 600.0
}
await execute_flight_plan("drone_001", flight_plan)

# 3. é£›è¡Œè¨ˆç”»ã®é€²æ—ç›£è¦–
status = await get_flight_plan_status("drone_001")
while status["task_running"]:
    await asyncio.sleep(5)
    status = await get_flight_plan_status("drone_001")
```

### ã‚·ãƒŠãƒªã‚ª2: é«˜ç²¾åº¦äººç‰©è¿½è·¡
```python
# 1. äººç‰©æ¤œå‡ºãƒ»è¿½è·¡ã‚·ã‚¹ãƒ†ãƒ è¨­å®š
tracking_config = {
    "algorithm": "csrt",        # é«˜ç²¾åº¦è¿½è·¡
    "confidence_threshold": 0.7, # é«˜ä¿¡é ¼åº¦
    "follow_distance": 300,     # 3mè·é›¢ç¶­æŒ
    "max_tracking_loss": 50,    # é•·æœŸãƒ­ã‚¹ãƒˆè¨±å®¹
    "update_interval": 0.05     # 20FPSæ›´æ–°
}

await start_tracking_enhanced(
    model_id="yolo_v8_person_detector",
    drone_id="drone_001",
    config=tracking_config
)

# 2. è¿½è·¡çŠ¶æ³ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
while True:
    status = await get_tracking_status_enhanced()
    for session in status["active_sessions"]:
        print(f"Target detected: {session['target_detected']}")
        print(f"Success rate: {session['success_rate']:.2f}")
        
        if session['success_rate'] < 0.7:
            print("Warning: Low tracking success rate")
    
    await asyncio.sleep(1)
```

### ã‚·ãƒŠãƒªã‚ª3: åŒ…æ‹¬çš„å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åé›†
```python
# 1. é«˜å“è³ªå­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹
session_id = await start_learning_session(
    object_name="manufacturing_part",
    session_config={
        "quality_threshold": 0.85,
        "auto_quality_filter": True,
        "metadata_extraction": True
    }
)

# 2. åŒ…æ‹¬çš„å¤šè§’åº¦ãƒ»å¤šé«˜åº¦æ’®å½±
collection_config = {
    "object_name": "manufacturing_part",
    "capture_positions": [
        "front", "back", "left", "right", 
        "front_left", "front_right", 
        "back_left", "back_right"
    ],
    "altitude_levels": [80, 100, 120, 150, 180, 200],  # 6ãƒ¬ãƒ™ãƒ«
    "rotation_angles": list(range(0, 360, 15)),         # 24è§’åº¦
    "photos_per_position": 5,                           # é«˜å¯†åº¦æ’®å½±
    "movement_distance": 40,                            # è¿‘è·é›¢ç²¾å¯†
    "quality": "high"
}

collection_result = await collect_learning_data_enhanced(
    drone_id="drone_001",
    config=collection_config
)

# 3. å“è³ªåˆ†æã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
summary = await finish_learning_session(session_id)
print(f"Collected {summary['total_samples']} samples")
print(f"High quality: {summary['high_quality_samples']}")
print(f"Average quality: {summary['average_quality']:.3f}")

quality_dist = summary['quality_distribution']
print(f"Quality distribution - High: {quality_dist['high']}, "
      f"Medium: {quality_dist['medium']}, Low: {quality_dist['low']}")
```

### ã‚·ãƒŠãƒªã‚ª4: å®‰å…¨æ€§é‡è¦–é‹ç”¨
```python
# 1. å³æ ¼ãªå®‰å…¨è¨­å®š
safety_config = {
    "min_battery_level": 25,        # é«˜ã‚ã®ãƒãƒƒãƒ†ãƒªãƒ¼é–¾å€¤
    "max_flight_time": 900,         # 15åˆ†åˆ¶é™
    "emergency_landing_battery": 20, # æ—©æœŸç·Šæ€¥ç€é™¸
    "wind_speed_limit": 3.0,        # ä½é¢¨é€Ÿåˆ¶é™
    "max_velocity": 1.5,            # ä½é€Ÿåˆ¶é™
    "flight_bounds": {
        "min_x": -5.0, "max_x": 5.0,   # ç‹­ã„ç¯„å›²
        "min_y": -5.0, "max_y": 5.0,
        "min_z": 0.5,  "max_z": 3.0    # ä½é«˜åº¦åˆ¶é™
    }
}
await update_safety_config(safety_config)

# 2. å®‰å…¨ãƒã‚§ãƒƒã‚¯ä»˜ãæ“ä½œ
try:
    await takeoff_drone("drone_001")
    await set_altitude_precise("drone_001", 100, "absolute", speed=0.3)
    await move_drone_enhanced("drone_001", {"direction": "forward", "distance": 200})
except ValueError as e:
    if "å®‰å…¨ãƒã‚§ãƒƒã‚¯" in str(e):
        print("Safety check prevented unsafe operation")
        # å®‰å…¨é•åã®è©³ç´°ç¢ºèª
        violations = await get_safety_violations("drone_001")
        for violation in violations[-5:]:  # æœ€æ–°5ä»¶
            print(f"Violation: {violation['type']} at {violation['timestamp']}")

# 3. ç¶™ç¶šçš„å®‰å…¨ç›£è¦–
while True:
    violations = await get_safety_violations("drone_001")
    recent_violations = [v for v in violations 
                        if (datetime.now() - v['timestamp']).seconds < 300]
    
    if recent_violations:
        print(f"Alert: {len(recent_violations)} safety violations in last 5 minutes")
        for v in recent_violations:
            if v['severity'] == 'critical':
                await emergency_stop_enhanced("drone_001")
                break
    
    await asyncio.sleep(10)
```

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºç­–

#### 1. ç²¾å¯†é«˜åº¦åˆ¶å¾¡ã®å¤±æ•—
```
Error: Target height too low/high
```
**è§£æ±ºç­–**: 
- å®‰å…¨å¢ƒç•Œå†…ã®é«˜åº¦ã‹ç¢ºèª (0.2m - 5.0m)
- ç¾åœ¨ã®é«˜åº¦ã‹ã‚‰å¦¥å½“ãªå¤‰åŒ–é‡ã‹ç¢ºèª
- ç›¸å¯¾ãƒ¢ãƒ¼ãƒ‰ã¨çµ¶å¯¾ãƒ¢ãƒ¼ãƒ‰ã®ä½¿ã„åˆ†ã‘ã‚’ç¢ºèª

#### 2. é£›è¡Œè¨ˆç”»å®Ÿè¡Œã‚¨ãƒ©ãƒ¼
```
Error: Safety check failed at waypoint N
```
**è§£æ±ºç­–**:
- å…¨ã‚¦ã‚§ã‚¤ãƒã‚¤ãƒ³ãƒˆãŒé£›è¡Œå¢ƒç•Œå†…ã‹ç¢ºèª
- ãƒãƒƒãƒ†ãƒªãƒ¼ãƒ¬ãƒ™ãƒ«ãŒååˆ†ã‹ç¢ºèª
- ã‚¦ã‚§ã‚¤ãƒã‚¤ãƒ³ãƒˆé–“ã®è·é›¢ãŒé©åˆ‡ã‹ç¢ºèª

#### 3. å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åé›†ã®å“è³ªå•é¡Œ
```
Warning: Low quality images detected (quality < 0.4)
```
**è§£æ±ºç­–**:
- ç…§æ˜æ¡ä»¶ã‚’æ”¹å–„
- ãƒ‰ãƒ­ãƒ¼ãƒ³ã®å®‰å®šæ€§ã‚’ç¢ºèªï¼ˆé¢¨ã®å½±éŸ¿ç­‰ï¼‰
- å¯¾è±¡ç‰©ã¨ã®è·é›¢ã‚’èª¿æ•´
- ã‚«ãƒ¡ãƒ©ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹è¨­å®šã‚’ç¢ºèª

#### 4. è¿½è·¡ã®å¤±æ•—ãƒ»ãƒ­ã‚¹ãƒˆ
```
Warning: Tracking lost for session
```
**è§£æ±ºç­–**:
- ã‚ˆã‚Šé«˜ç²¾åº¦ãªã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆCSRTï¼‰ã‚’ä½¿ç”¨
- ä¿¡é ¼åº¦é–¾å€¤ã‚’èª¿æ•´
- è¿½è·¡å¯¾è±¡ãŒé©åˆ‡ã«ãƒ•ãƒ¬ãƒ¼ãƒ å†…ã«ã„ã‚‹ã‹ç¢ºèª
- èƒŒæ™¯ã¨ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã‚’æ”¹å–„

#### 5. ãƒ¡ãƒ¢ãƒªä¸è¶³ãƒ»æ€§èƒ½å•é¡Œ
```
Error: System performance degraded
```
**è§£æ±ºç­–**:
- ã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’å®Ÿè¡Œ
- å¤ã„å­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å‰Šé™¤
- åŒæ™‚è¿½è·¡æ•°ã‚’åˆ¶é™
- ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã‚’ç¢ºèª

### ãƒ‡ãƒãƒƒã‚°ç”¨ã‚³ãƒãƒ³ãƒ‰

```bash
# 1. ãƒ‰ãƒ­ãƒ¼ãƒ³è©³ç´°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
curl -X GET "http://localhost:8000/api/drones/drone_001/status/enhanced" \
  -H "X-API-Key: your-api-key"

# 2. å®‰å…¨é•åå±¥æ­´ç¢ºèª
curl -X GET "http://localhost:8000/api/drones/drone_001/safety/violations" \
  -H "X-API-Key: your-api-key"

# 3. é£›è¡Œãƒ­ã‚°ç¢ºèª
curl -X GET "http://localhost:8000/api/drones/drone_001/logs/flight?limit=50" \
  -H "X-API-Key: your-api-key"

# 4. ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ãƒ˜ãƒ«ã‚¹ç¢ºèª
curl -X GET "http://localhost:8000/api/system/health/enhanced" \
  -H "X-API-Key: your-api-key"

# 5. ãƒ“ã‚¸ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ åˆ†æ
curl -X GET "http://localhost:8000/api/system/analytics/vision" \
  -H "X-API-Key: your-api-key"

# 6. ç·åˆã‚·ã‚¹ãƒ†ãƒ åˆ†æ
curl -X GET "http://localhost:8000/api/system/analytics/overall" \
  -H "X-API-Key: your-api-key"
```

### ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª

```bash
# APIã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°
tail -f logs/api_server.log | grep -E "(ERROR|WARNING|CRITICAL)"

# ç‰¹å®šãƒ‰ãƒ­ãƒ¼ãƒ³ã®æ“ä½œãƒ­ã‚°
tail -f logs/api_server.log | grep "drone_001"

# å®‰å…¨é•åãƒ­ã‚°
tail -f logs/api_server.log | grep "safety_violation"

# è¿½è·¡é–¢é€£ãƒ­ã‚°
tail -f logs/api_server.log | grep -E "(tracking|detection)"
```

## ğŸ“š æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

Phase 3 Enhanced ã®å®Ÿè£…ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®é«˜åº¦ãªæ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã—ãŸï¼š

### âœ… é”æˆã•ã‚ŒãŸæ©Ÿèƒ½
1. **ç”£æ¥­ç”¨é€”å¯¾å¿œã®ç²¾å¯†åˆ¶å¾¡**: 5cmç²¾åº¦ã®ä½ç½®åˆ¶å¾¡
2. **åŒ…æ‹¬çš„å®‰å…¨ã‚·ã‚¹ãƒ†ãƒ **: å¤šå±¤é˜²å¾¡ã«ã‚ˆã‚‹äº‹æ•…é˜²æ­¢
3. **é«˜åº¦ãªãƒ“ã‚¸ãƒ§ãƒ³å‡¦ç†**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ¤œå‡ºãƒ»è¿½è·¡
4. **åŠ¹ç‡çš„ãªå­¦ç¿’ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ**: AIé–‹ç™ºã®å¤§å¹…ãªåŠ é€Ÿ
5. **è©³ç´°ãªç›£è¦–ãƒ»åˆ†æ**: é‹ç”¨æœ€é©åŒ–ã®ãŸã‚ã®ã‚¤ãƒ³ã‚µã‚¤ãƒˆ

### ğŸš€ Phase 4ã¸ã®å±•é–‹äºˆå®š
1. **ãƒãƒ«ãƒãƒ‰ãƒ­ãƒ¼ãƒ³å”èª¿åˆ¶å¾¡**: è¤‡æ•°æ©Ÿä½“ã®é€£æºé£›è¡Œ
2. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿæ¢°å­¦ç¿’**: ã‚¨ãƒƒã‚¸ã§ã®å­¦ç¿’ãƒ»æ¨è«–
3. **é«˜åº¦ã‚»ãƒ³ã‚µãƒ¼çµ±åˆ**: LiDARã€IMUç­‰ã®çµ±åˆ
4. **ã‚¯ãƒ©ã‚¦ãƒ‰é€£æº**: ãƒªãƒ¢ãƒ¼ãƒˆç›£è¦–ãƒ»åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ 
5. **Web UI Dashboard**: åŒ…æ‹¬çš„ãªæ“ä½œãƒ»ç›£è¦–ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

### ğŸ”§ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ»æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ
1. **ã‚«ã‚¹ã‚¿ãƒ å®‰å…¨ãƒ«ãƒ¼ãƒ«**: ç‰¹å®šç”¨é€”ã«å¿œã˜ãŸå®‰å…¨è¨­å®š
2. **ç‹¬è‡ªãƒ“ã‚¸ãƒ§ãƒ³ãƒ¢ãƒ‡ãƒ«**: ç‰¹å®šç‰©ä½“ã«ç‰¹åŒ–ã—ãŸãƒ¢ãƒ‡ãƒ«
3. **é£›è¡Œãƒ‘ã‚¿ãƒ¼ãƒ³**: ç‰¹å®šã‚¿ã‚¹ã‚¯ç”¨ã®é£›è¡Œã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
4. **ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³**: åé›†ãƒ‡ãƒ¼ã‚¿ã®è‡ªå‹•å‡¦ç†
5. **å¤–éƒ¨ã‚·ã‚¹ãƒ†ãƒ é€£æº**: æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆ

## ğŸ“„ é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Phase 1 README](../mcp-server/README.md) - åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ 
- [Phase 2 README](../mcp-server/PHASE2_README.md) - è‡ªç„¶è¨€èªå‡¦ç†
- [Phase 3 README](./PHASE3_README.md) - åŸºæœ¬ãƒ“ã‚¸ãƒ§ãƒ³ãƒ»ãƒ¢ãƒ‡ãƒ«ç®¡ç†
- [APIä»•æ§˜](../shared/api-specs/mcp-api.yaml) - MCP APIä»•æ§˜
- [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIä»•æ§˜](../shared/api-specs/backend-api.yaml) - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API

## ğŸ¤ è²¢çŒ®ãƒ»ã‚µãƒãƒ¼ãƒˆ

### è²¢çŒ®æ–¹æ³•
1. **Issueä½œæˆ**: æ©Ÿèƒ½è¦æ±‚ã‚„ãƒã‚°ãƒ¬ãƒãƒ¼ãƒˆ
2. **Pull Request**: å®Ÿè£…æ”¹å–„ã‚„æ–°æ©Ÿèƒ½
3. **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ **: ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š
4. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ”¹å–„**: ä½¿ç”¨ä¾‹ã‚„èª¬æ˜ã®è¿½åŠ 

### ã‚µãƒãƒ¼ãƒˆ
- æŠ€è¡“çš„ãªè³ªå•: GitHub Issues
- æ©Ÿèƒ½è¦æ±‚: Feature Request ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- ãƒã‚°ãƒ¬ãƒãƒ¼ãƒˆ: Bug Report ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

---

**Phase 3 Enhanced Drone Control Features** - æ¬¡ä¸–ä»£ãƒ‰ãƒ­ãƒ¼ãƒ³åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ ã§ã€å®‰å…¨ã§ç²¾å¯†ã§è³¢ã„é£›è¡Œã‚’å®Ÿç¾